# Основная конфигурация LoraQween

paths:
  data_dir: "data"
  datasets_dir: "data/datasets"
  references_dir: "data/references"
  regularization_dir: "data/regularization"
  models_dir: "models"
  base_model_dir: "models/base"
  loras_dir: "models/loras"
  face_id_dir: "models/face_id"
  logs_dir: "logs"
  outputs_dir: "outputs"
  comfyui_dir: "comfyui"

model:
  backend: "flux"  # flux (default) или qwen (устаревший режим)
  base_model_id: "black-forest-labs/FLUX.1-dev"
  dtype: "bf16"
  revision: null
  variant: null

base_model:  # устаревшее поле для совместимости с Qwen backend
  name: "Qwen/Qwen-Image"
  dtype: "bf16"
  text_encoder: "auto"
  vae: "auto"
  tokenizer: "auto"

training:
  resolution: 768
  lora_rank: 16
  lora_alpha: 32
  lora_dropout: 0.1
  target_modules:
    - "to_q"
    - "to_k"
    - "to_v"
    - "to_out.0"
  text_encoder_target_modules:
    - "q_proj"
    - "k_proj"
    - "v_proj"
    - "o_proj"
  learning_rate: 5e-5
  max_steps: 4000
  batch_size: 1
  gradient_accumulation_steps: 4
  effective_batch_size: 4
  mixed_precision: "bf16"
  gradient_checkpointing: true
  save_steps: 500
  eval_steps: 500
  logging_steps: 50

hardware:
  max_cpu_ram_gb: 40
  max_vram_gb: 24
  dataloader_workers: 2
  prefetch_factor: 1
  max_batch_size: 2
  device_map: "cuda"
  offload_state_dict: true

inference:
  fast_mode:
    lora_scale: 0.8
    cfg_scale: 7.0
    num_steps: 40
    sampler: "euler"
    batch_size: 4
    resolution: 768

  reliable_mode:
    lora_scale: 0.9
    cfg_scale: 7.5
    num_steps: 60
    sampler: "euler"
    batch_size: 2
    resolution: 1024
    face_id_weight: 0.6
    use_controlnet: true

quality_control:
  face_id_model: "buffalo_l"
  similarity_threshold: 0.7
  fpr_target: 0.01
  tpr_target: 0.90
  validation_split: 0.2
  stress_test_count: 15

vram:
  monitor_interval: 1.0
  fallback_threshold: 0.95
  degraded_profile:
    resolution: 512
    num_steps: 30
    batch_size: 1

logging:
  retention_days: 30
  log_level: "INFO"
  log_inference: true
  log_training: true

security:
  clear_exif: true
  encrypt_references: false
  access_control: true
